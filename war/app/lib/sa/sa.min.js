/* Simpler Apps (SA) Framework v1.0.2 16-12-2015 */
function SimplerApps(){function a(a){var b=SA.comps.getCompsByIdsFromHtml(a);for(i=0;i<b.length;i++){var c=b[i];c.postLoad&&c.setActionListener&&c.postLoad()}for(i=0;i<b.length;i++){var c=b[i];c.postLoad&&!c.setActionListener&&c.postLoad()}}function b(a){var b=a.indexOf("#!/");if(b>=0){var c=a.substring(b+3);return c.split("/")}}var c="simplerapps",d=c+"-auth",e={appName:"sa",hostName:"localhost:8888"};this.htmlExclusionMap={html:"",items:"",config:""},this.ui={},String.prototype.insert=function(a,b){var c=this.slice(0,a),d=this.slice(a);return c+b+d},String.prototype.encodeHtml||(String.prototype.encodeHtml=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),String.prototype.decodeHtml||(String.prototype.decodeHtml=function(){return this.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}),function(b,c){b.fn.html=function(){var b=c.apply(this,arguments),d=arguments[0];return a(d),b}}(jQuery,jQuery.fn.html),function(b,c){b.fn.append=function(){var b=c.apply(this,arguments);return"string"==typeof arguments[0]?a(arguments[0]):"object"==typeof arguments[0],b}}(jQuery,jQuery.fn.append),this.loadComponent=function(a,c,d){var e=SA.loader.getComponent("_main",c,!0);if(SA.loadCssIntoDom("",e.css),e.flow||(e.flow={}),d&&(e.config=d),!e.createUI)return void alert("Invalid State: component should define createUI method");var g=e.createUI(e,{});if($("#"+a).html(g),f){var h=b(window.location.href);h&&h.length>0&&SA.events.fireEvent(f.compId,{id:"navigate",compIdArray:h})}},window.onpopstate=function(){if(f){var a=b(window.location.hash);a&&a.length>0?SA.events.fireEvent(f.compId,{id:"navigate",compIdArray:a}):SA.events.fireEvent(f.compId,{id:"navigate",compIdArray:["HOME"]})}};var f=void 0;this.setDispatchComponent=function(a){f=a},this.fireEvent=function(a,b){SA.events.fireEvent(a,b)},this.loadInclues=function(){},this.execFunction=function(a,b){for(var c=window,d=a.split("."),e=0;e<d.length;e++)c=c[d[e]];try{return c[b].apply(this)}catch(f){alert('Invalid State: Error in: "'+a+"."+b+'". Reason: '+f)}},this.listCreateUI=function(a,b,c,d){return void 0==d&&(d=!0),SA.loader._callAllCreateUI(a,b,c,d)},this.createUI=function(a,b,c,d){return void 0==d&&(d=!0),SA.loader._callAllCreateUI(a,b,c,d)},this.injectStyle=function(a,b){if(a){var c=a.indexOf('style="');if(c>=0){var d=a.indexOf('"',c+7);d>0&&(a=a.insert(d,";"+b))}else if(c=a.indexOf("<div"),c>=0){var e=' style="'+b+'"';a=a.insert(4,e)}}return a},this.injectClass=function(a,b){if(a){var c=a.indexOf('class="');if(c>=0){var d=a.indexOf('"',c+7);d>0&&(a=a.insert(d," "+b))}else if(c=a.indexOf("<div"),c>=0){var e=' class="'+b+'"';a=a.insert(4,e)}}return a},this.mergeConfig=function(a,b){return a||(a={}),b&&(a=$.extend(a,b)),a},this.getAtomComponent=function(a,b){return SA.loader.getComponent(a,b,!1)},this.getListComponent=function(a,b){return SA.loader.getComponent(a,b,!0)},this.createComponent=function(a,b){return SA.loader.getComponent(a,b,!0)},this.lookupComponent=function(a){return SA.comps.getCompByIdOrName(a)},this.getCompByIdOrName=function(a){return SA.comps.getCompByIdOrName(a)},this.getList=function(a){return SA.comps.getList(a)},this.getListItemByName=function(a,b){var c=a.items;if(c)for(var d=0;d<c.length;d++){var e=c[d];if(e&&e.name==b)return e}return void 0},this.getConfig=function(a,b,c){return SA.getConfigValue(a,b,c)},this.getConfigValue=function(a,b,c){var d=c,e=a.config;if(e){var f=e[b];void 0!=f&&(d=f)}return d},this.addSublist=function(a,b){return a.items||(a.items=new Array),a.items.push(b),a},this.createHtmlBegin=function(a,b){a.html||(a.html="div");var c="<"+a.html;a.id||a.name&&(a.id=a.name);var d=this._listHidden(a,b);if(!d)for(var e in a){var f=a[e],g=this.htmlExclusionMap[e];void 0==g&&(0==e.indexOf("data_")&&(e="data-"+e.substring(5)),c+=" "+e+"='"+f+"'")}return c+=">"},this._listHidden=function(a,b){var c=a.config&&1==a.config.hidden&&1!=b;return c},this.createHtmlEnd=function(a){return a.value?a.value+"</"+a.html+">":a.html?"</"+a.html+">":""},this.localCss=function(a,b){var c=a.compTypeId;return c?b=c>1?b+"-"+c:b:alert("Invalid State: cannot find local css class name '"+b+"' in component."),b},this.loadCssIntoDom=function(a,b){if(b&&b.items){var c="",d={};c=this._loadCssList(a,c,d,b),SA.comps.setComponentCssNames(a,d),this.addCssToDOM(c)}},this._loadCssList=function(a,b,c,d){var e=d.items;if(void 0!=e){if(e.length>0){var f="",g=0;for(g=0;g<e.length;g++)f=this._loadCssList(a,f,c,e[g]);b+=d.name?d.name+"{"+f+"} ":f}}else{var h="";a&&a>0&&(h="-"+a);var i=0,j="",k=d.name.split(" ");for(i=0;i<k.length;i++)k[i].length>0&&(clname="."==k[i][0]?k[i]+h+" ":k[i]+" ",j+=clname,c[clname.trim()]="");b+=j+"{ "+d.value+" } "}return b},this.addCssToDOM=function(a){var b=document.getElementsByTagName("style")[0],c="";b?c=b.innerHTML:(b=document.createElement("style"),b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b)),b.innerHTML=c+a};var g=void 0;this.setAppData=function(a,b){var d=c+"-"+e.appName+"-"+a;SA.utils.setStorage(d,b)},this.getAppData=function(a){var b=c+"-"+e.appName+"-"+a;return SA.utils.getStorage(b)},this.deleteAppData=function(a){var b=c+"-"+e.appName+"-"+a;SA.utils.removeStorage(b)},this.setUserAuth=function(a){if("OK"==a.status){g=a;var b=JSON.stringify(a);SA.utils.setStorage(d,b)}},this.getUserAuth=function(){if(g)return g;var a=SA.utils.getStorage(d);return a&&a.length>0?g=jQuery.parseJSON(a):void 0},this.deleteUserAuth=function(){g&&(g=void 0),SA.utils.removeStorage(d),SA.utils.deleteCookie("JSESSIONID")},this.setAppConfig=function(a){a&&(a.appName&&a.appName.length>0&&(e.appName=a.appName,d=c+"-"+e.appName+"-auth"),a.hostName&&a.hostName.length>0&&(e.hostName=a.hostName,SA.server.setMyHostName(e.hostName)))},this.localUrl=function(a){SA.utils.localUrl(a)}}function Comps(){function a(b,c,d){var e,f,g="-"+b,h="",i="",j="";if(c.class){var k=c.class.split(" ");for(e=0;e<k.length;e++)k[e].length>0&&(h=k[e],i=h+g,j+=void 0!=d["."+i]?i+" ":h+" ");c.class=j.trim()}if(c.items)for(f=0;f<c.items.length;f++)a(b,c.items[f],d)}this._componentRegistry={},this._listRegistry={},this._compKeyByObjName={},this._compKeyByCompName={},this._maxComponentId=0,this.putList=function(a){a.name&&(this._listRegistry[a.name]=a)},this.getList=function(a){return this._listRegistry[a]},this.getCompsByIdsFromHtml=function(a){var b=Array(),c=0,d=0,e="";if(a)for(a=a.replace(/'/g,'"');;){if(d=a.indexOf('id="',c),0>d)break;d+=4,c=a.indexOf('"',d),e=a.substring(d,c);var f=this.getCompByIdOrName(e);void 0!=f&&b.push(f),c++}return b},this.getComponentMap=function(){return this._componentRegistry},this.setComponentCssNames=function(b,c){var d=this._componentRegistry[b];d&&d.flow&&a(b,d.flow,c)},this.addComponent=function(a,b,c){var d=this._genNewId(),e=d,e=this._compKeyByObjName[a];e||(e=d),b.compObjName=a,b.compTypeId=e,b.compId=d,b.id=c?c:d,this._componentRegistry[d]=b,e==d&&(this._compKeyByObjName[a]=e),c&&(this._compKeyByCompName[c]=d)},this.getCompByIdOrName=function(a){return isNaN(a)?this.getCompByName(a):this._componentRegistry[a]},this.getCompById=function(a){return this._componentRegistry[a]},this.getCompByObjName=function(a){var b=this._compKeyByObjName[a];return b?this._componentRegistry[b]:void 0},this.getCompByName=function(a){var b=this._compKeyByCompName[a];return b?this._componentRegistry[b]:void 0},this._genNewId=function(){return++this._maxComponentId}}function Connector(a,b){this.ws=void 0,this.connectUrl=a,this.wsListener=b,this.connect=function(){"WebSocket"in window?(this.ws=new WebSocket(this.connectUrl),this.ws.onopen=function(){b.onOpen()},this.ws.onmessage=function(a){var c=a.data;b.onMessage(c)},this.ws.onclose=function(){b.onClose()}):alert("WebSocket NOT supported by your Browser!")},this.setConnectionListener=function(a){this.wsListener.listener=a},this.sendString=function(a){return this.ws?(this.ws.send(a),!0):(alert("Not connected yet!"),!1)},this.sendJsonObj=function(a){return this.ws?(this.ws.send(JSON.stringify(a)),!0):(alert("Not connected yet!"),!1)}}function ConnectListener(){this.listener=void 0,this.onOpen=function(){console.log("connection open")},this.onMessage=function(a){if(this.listener){var b=JSON.parse(a);this.listener.onMessage(b)}},this.onClose=function(){console.log("connection closed")}}function Events(){function a(a){0==f&&(setTimeout(a,10),f=!0)}function b(){f=!1}function c(){for(b=0;b<e.length;b++){var a=e[b];d(a)}for(var b=e.length;b--;)a=e[b],1==a.done&&e.splice(b)}function d(a){var b=SA.comps.getCompByIdOrName(a.selector);if(b&&b.handleEvent)return b.handleEvent(a.event),void(a.done=!0);var c=$("#"+a.selector);c.length?(c.trigger(a.event),a.done=!0):(a.fc++,5==a.fc&&(a.done=!0))}var e=new Array,f=!1;this.fireEvent=function(d,f){function g(){c(),e.length>0?(b(),a(g)):b()}var h={};h.selector=d,h.event=f,h.fc=0,e.push(h),a(g)}}function Loader(){this._callAllCreateUI=function(a,b,c,d){var e="";return c&&(b.config=SA.mergeConfig(b.config,c)),void 0==b.oid&&(b.oid=a),this.processCreateUI(b,b.config,e,d)},this.processCreateUI=function(a,b,c,d){if(a.label&&(a.label=SA.res.getValue(a.label)),a.value&&(a.value=SA.res.getValue(a.value)),a.ac){var e=this.callAtomComp(a,a.ac,b);return e}var f=d&&1==d;if(SA.comps.putList(a),this.flowHasCustomHandler(a)){var g=this.callHandler(a,b,f);return g}if(a.items){var h=SA.createHtmlBegin(a,f),i="";i+=h;var j=SA._listHidden(a,f),k=0;for(k=0;!j&&k<a.items.length;k++){var l=a.items[k];l.oid=a.oid;var m=this.processCreateUI(l,b,c);m&&(i+=m)}return i+=SA.createHtmlEnd(a),c+=i,i}return SA.createHtmlBegin(a,void 0,void 0)+SA.createHtmlEnd(a)},this.getComponentClass=function(a){for(var b=a.split("."),c=b.length,d=window,e=0;c>e;++e)d=d[b[e]];return void 0==d&&alert("Invalid State: Undefined object: "+a),d},this.flowHasCustomHandler=function(a){var b=a.lc;return b&&b.length>0&&"SA.loader"!=b},this.callAtomComp=function(a,b,c){var d=this.getComponent(a.name,a.ac,!1),e=SA.mergeConfig(a.config,c);return d.createUI(a,e)},this.callHandler=function(a,b,c){var d=this.getComponent(a.name,a.lc,!0);return a.config&&a.config.hidden&&1!=c?"":d.createUI(a,b)},this._getHiddenListPanel=function(a){return a.name?'<div id="'+a.name+'" />':""},this.getComponent=function(a,b){var c=SA.comps.getCompByName(a);if(!c)if(c=SA.comps.getCompByObjName[b]){if(c.stateful){var d=this.getComponentClass(b);c=new d,SA.comps.addComponent(b,c,a)}}else{var d=this.getComponentClass(b);if(c=new d,SA.comps.addComponent(b,c,a),"_main"!=a&&SA.loadCssIntoDom(c.compTypeId,c.css),c.model&&c.model.items)for(i=0;i<c.model.items.length;i++){var e=c.model.items[i];SA.comps.putList(e)}}return c},this.handleAction=function(){}}function Res(){function a(a){var d=b("res/str/"+a+".html");d&&0!=d.length||console.log("Invalid State: cannot load resource from file: "+a);for(var e=d.indexOf("<!--KEY:"),f=0;;){if(e>=0&&(e+=8,f=d.indexOf("-->",e),f>0)){var g=d.substring(e,f);if(e=f+3,f=d.indexOf("<!--KEY:",e),f>0){var h=d.substring(e,f);c[a+"."+g.trim()]=h.trim(),e=f;continue}var h=d.substring(e);c[a+"."+g.trim()]=h.trim()}break}}function b(a){var b="";return $.ajax({url:a,type:"GET",dataType:"text",async:!1,success:function(a){b=a},error:function(b,c,d){alert("Cannot load resource file: "+a+", cause: "+d)}}),b}var c={};this.getValue=function(a){if(a.indexOf("STR:")<0)return a;var b=a.indexOf(".",4);return b>0?this.getStrValue(a.substring(4,b),a.substring(b+1)):a},this.getStrValue=function(b,d){var e=c[b+"."+d];return void 0==e&&a(b),c[b+"."+d]}}function Server(){function a(a){return a.id&&a.id>0?"put":"post"}function b(a){var b=SA.getUserAuth();if(b){var c=b.jsessionid;c&&c.length>0&&(a+=";jsessionid="+c)}return a}var c="http://localhost:8888";this.setMyHostName=function(a){c=a},this.getMyHostName=function(){return c},this.set=function(d,e,f){d=c+d;var g=JSON.stringify(e);d=b(d),$.ajax({type:a(e),url:d,data:g,success:f})},this.postForm=function(a,d,e){a=c+a,a=b(a),$.ajax({type:"post",url:a,data:d,success:e,cache:!1,contentType:!1,processData:!1})},this.putForm=function(a,d,e){a=c+a,a=b(a),$.ajax({type:"put",url:a,data:d,success:e,cache:!1,contentType:!1,processData:!1})},this.get=function(a,d,e){a=c+a,a=b(a),a+="?";for(var f in d)a+=f+"="+d[f]+"&";rsUtl=a.substring(0,a.length-1),$.ajax({type:"get",url:a,success:e})},this.del=function(a,d,e){a=c+a,a=b(a),a+="?";for(var f in d)a+=f+"="+d[f]+"&";rsUtl=a.substring(0,a.length-1),$.ajax({type:"delete",url:a,success:e})},this.getMediaUrl=function(a){return c+"/media/"+a}}function Utils(){function a(a){navigator.camera.getPicture(this.onCaptureSuccess,this.onCaptureFail,{destinationType:Camera.DestinationType.FILE_URI,sourceType:a,correctOrientation:!0})}function b(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}this.setStorage=function(a,b){window.localStorage.setItem(a,b)},this.getStorage=function(a){return window.localStorage.getItem(a)},this.removeStorage=function(a){window.localStorage.removeItem(a)},this.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},this.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(-1!=e.indexOf(b))return e.substring(b.length,e.length)}return""},this.deleteCookie=function(a){var b="expires=Thu, 01 Jan 1970 00:00:00 UTC";document.cookie=a+"=; "+b};var c="iPad"==navigator.userAgent.match(/iPad/i)?"iPad":"iPhone"==navigator.userAgent.match(/iPhone/i)?"iPhone":"Android"==navigator.userAgent.match(/Android/i)?"Android":"BlackBerry"==navigator.userAgent.match(/BlackBerry/i)?"BlackBerry":"Browser",d=!("Browser"==c);this.getDeviceType=function(){return c},this.isMobileDevice=function(){return d},this.getPhoto=function(){"Browser"==c||this.phoneUseExistingPhoto()},this.phoneUseExistingPhoto=function(){a(Camera.PictureSourceType.SAVEDPHOTOALBUM)},this.phoneTakePhoto=function(){a(Camera.PictureSourceType.CAMERA)},this.mergeList=function(a,b){var c=a.items;if(c&&c.length>0){var d=0;for(d=0;d<c.length;d++){var e=c[d];if(e.name){var f=b[e.name];e.value=f?f:""}}}a.config||(a.config={}),b.config||(b.config={}),jQuery.extend(a.config,b.config)};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode64=function(a){var c,d,f,g,h,i,j,k="",l=0;for(a=b(a);l<a.length;)c=a.charCodeAt(l++),d=a.charCodeAt(l++),f=a.charCodeAt(l++),g=c>>2,h=(3&c)<<4|d>>4,i=(15&d)<<2|f>>6,j=63&f,isNaN(d)?i=j=64:isNaN(f)&&(j=64),k=k+e.charAt(g)+e.charAt(h)+e.charAt(i)+e.charAt(j);return k},this.localUrl=function(a){window.location=a.href,window.location.reload(!0)}}function Validate(){function a(a){return a.label?a.label:a.info?a.info:a.name}var b=0,c=1,d=2,e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,f={maxWidth:60,validate:function(a){var d=c;return a&&""!=a&&a.length>0&&(d=b),d}},g={email:{maxWidth:150,validate:function(a){var f=c;return a&&""!=a&&a.length>0&&(f=e.test(a)?b:d),f}}};this.evalObj=function(d,e){for(i=0;i<d.length;i++){var f=d[i];if(f.name){var g=e[f.name],h=this.eval(f.pattern,g);if(h!=b){var j=a(f);if(h!=c)return"'"+j+"' is invalid!";if(f.required){var k=j.indexOf(" (required)");return k>0&&(j=j.substring(0,k)+j.substring(k+11)),'Field "'+j+'" cannot be empty!'}}}}return""},this.eval=function(a,b){var c=this.getPattern(a);return c.validate(b)},this.getPattern=function(a){a||(a="");var b=g[a];return b?b:f}}var SA=new SimplerApps;SA.comps=new Comps,SA.connector=new Connector("ws://localhost:8080/simplq/search",new ConnectListener),SA.events=new Events,SA.loader=new Loader,SA.res=new Res,SA.server=new Server,SA.utils=new Utils,SA.validate=new Validate;